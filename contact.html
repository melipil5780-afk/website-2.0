export default {
  async fetch(request, env) {
    const corsHeaders = {
      "Access-Control-Allow-Origin": "*",
      "Access-Control-Allow-Methods": "POST, OPTIONS",
      "Access-Control-Allow-Headers": "Content-Type",
    };

    if (request.method === "OPTIONS") return new Response(null, { headers: corsHeaders });

    try {
      const body = await request.json();

      const send_request = new Request('https://api.mailchannels.net/tx/v1/send', {
        method: 'POST',
        headers: { 'content-type': 'application/json' },
        body: JSON.stringify({
          personalizations: [{ to: [{ email: 'melipil5780@gmail.com' }] }],
          // This "from" address is a placeholder that works with Cloudflare's internal network
          from: { email: 'form@website-2-0-bkz.pages.dev', name: 'Website Form' },
          subject: 'New Inquiry from Sovereign',
          content: [{
            type: 'text/plain',
            value: `Email: ${body.email}\nPhone: ${body.phone}\n\nVision: ${body.message}`
          }],
        }),
      });

      const res = await fetch(send_request);
      
      return new Response(JSON.stringify({ status: "Sent" }), {
        status: 200,
        headers: corsHeaders
      });

    } catch (e) {
      return new Response(JSON.stringify({ error: e.message }), { 
        status: 500, 
        headers: corsHeaders 
      });
    }
  }
};
